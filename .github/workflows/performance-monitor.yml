# WizCoCo ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì›Œí¬í”Œë¡œìš°
# 30ë…„ ê²½ë ¥ ì›¹ë””ìì´ë„ˆ ê²€í†  ì™„ë£Œ
name: ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 6ì‹œì— ì‹¤í–‰
    - cron: '0 6 * * *'
  workflow_dispatch:
  push:
    branches: [ main, master ]
    paths:
      - 'src/**'
      - 'next.config.js'
      - 'tailwind.config.js'

jobs:
  performance-test:
    name: ğŸš€ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      run: npm ci --legacy-peer-deps
      
    - name: ğŸŒ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
      run: |
        echo "NODE_ENV=production" > .env
        echo "SKIP_DB_INIT=true" >> .env
        echo "NEXT_TELEMETRY_DISABLED=1" >> .env
        echo "CI=true" >> .env
        echo "GITHUB_ACTIONS=true" >> .env
        
    - name: ğŸ—ï¸ í”„ë¡œì íŠ¸ ë¹Œë“œ
      run: npm run build
      
    - name: ğŸ“Š ë²ˆë“¤ í¬ê¸° ë¶„ì„
      run: |
        echo "ğŸ“Š ë²ˆë“¤ í¬ê¸° ë¶„ì„:"
        echo "=== ë©”ì¸ ë²ˆë“¤ ==="
        find .next/static/chunks -name "*.js" -exec ls -lh {} \; | head -10
        
        echo ""
        echo "=== CSS ë²ˆë“¤ ==="
        find .next/static/css -name "*.css" -exec ls -lh {} \;
        
        echo ""
        echo "=== ì´ë¯¸ì§€ íŒŒì¼ ==="
        find .next/static -name "*.png" -o -name "*.jpg" -o -name "*.jpeg" -o -name "*.gif" -o -name "*.webp" | head -5
        
    - name: ğŸ” í˜ì´ì§€ ë¡œë”© ì„±ëŠ¥ ë¶„ì„
      run: |
        echo "ğŸ” í˜ì´ì§€ ë¡œë”© ì„±ëŠ¥ ë¶„ì„:"
        
        # í˜ì´ì§€ ìˆ˜ ê³„ì‚°
        page_count=$(find src/app -name "page.tsx" | wc -l)
        echo "ğŸ“„ ì´ í˜ì´ì§€ ìˆ˜: $page_countê°œ"
        
        # ì»´í¬ë„ŒíŠ¸ ìˆ˜ ê³„ì‚°
        component_count=$(find src/components -name "*.tsx" | wc -l)
        echo "ğŸ§© ì´ ì»´í¬ë„ŒíŠ¸ ìˆ˜: $component_countê°œ"
        
        # TypeScript íŒŒì¼ ìˆ˜ ê³„ì‚°
        ts_count=$(find src -name "*.ts" -o -name "*.tsx" | wc -l)
        echo "ğŸ“ ì´ TypeScript íŒŒì¼ ìˆ˜: $ts_countê°œ"
        
        # ë²ˆë“¤ í¬ê¸° ê³„ì‚°
        bundle_size=$(du -sh .next | cut -f1)
        echo "ğŸ“¦ ì´ ë²ˆë“¤ í¬ê¸°: $bundle_size"
        
    - name: ğŸ¨ UI/UX ì„±ëŠ¥ ê²€ì‚¬
      run: |
        echo "ğŸ¨ UI/UX ì„±ëŠ¥ ê²€ì‚¬:"
        
        # Tailwind CSS í´ë˜ìŠ¤ ì‚¬ìš©ëŸ‰
        echo "ğŸ¨ Tailwind CSS í´ë˜ìŠ¤ ì‚¬ìš©ëŸ‰:"
        grep -r "className=" src/ --include="*.tsx" | grep -o "className=\"[^\"]*\"" | sort | uniq -c | sort -nr | head -10
        
        # ë°˜ì‘í˜• ë””ìì¸ í´ë˜ìŠ¤
        echo ""
        echo "ğŸ“± ë°˜ì‘í˜• ë””ìì¸ í´ë˜ìŠ¤:"
        grep -r "sm:\|md:\|lg:\|xl:" src/ --include="*.tsx" | wc -l | xargs echo "ë°˜ì‘í˜• í´ë˜ìŠ¤ ì‚¬ìš©: $1ê°œ"
        
        # ì ‘ê·¼ì„± ì†ì„±
        echo ""
        echo "â™¿ ì ‘ê·¼ì„± ì†ì„±:"
        grep -r "aria-\|role=" src/ --include="*.tsx" | wc -l | xargs echo "ì ‘ê·¼ì„± ì†ì„± ì‚¬ìš©: $1ê°œ"
        
    - name: ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì €ì¥
      uses: actions/upload-artifact@v4
      with:
        name: performance-metrics
        path: .next/
        retention-days: 30
        
    - name: ğŸ“Š ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
      run: |
        echo "ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë¦¬í¬íŠ¸ ìƒì„±:"
        echo "=== ì„±ëŠ¥ ìš”ì•½ ===" > performance-report.txt
        echo "í…ŒìŠ¤íŠ¸ ì‹œê°„: $(date)" >> performance-report.txt
        echo "ì´ í˜ì´ì§€ ìˆ˜: $(find src/app -name 'page.tsx' | wc -l)ê°œ" >> performance-report.txt
        echo "ì´ ì»´í¬ë„ŒíŠ¸ ìˆ˜: $(find src/components -name '*.tsx' | wc -l)ê°œ" >> performance-report.txt
        echo "ë²ˆë“¤ í¬ê¸°: $(du -sh .next | cut -f1)" >> performance-report.txt
        echo "TypeScript íŒŒì¼ ìˆ˜: $(find src -name '*.ts' -o -name '*.tsx' | wc -l)ê°œ" >> performance-report.txt
        
        echo ""
        echo "=== ê¶Œì¥ì‚¬í•­ ===" >> performance-report.txt
        echo "1. ì´ë¯¸ì§€ ìµœì í™”: WebP í˜•ì‹ ì‚¬ìš© ê¶Œì¥" >> performance-report.txt
        echo "2. ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…: ë™ì  import í™œìš©" >> performance-report.txt
        echo "3. ìºì‹± ì „ëµ: ì ì ˆí•œ ìºì‹œ í—¤ë” ì„¤ì •" >> performance-report.txt
        echo "4. ë²ˆë“¤ ìµœì í™”: ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„± ì œê±°" >> performance-report.txt
        
    - name: ğŸ“„ ì„±ëŠ¥ ë¦¬í¬íŠ¸ ì €ì¥
      uses: actions/upload-artifact@v4
      with:
        name: performance-report
        path: performance-report.txt
        retention-days: 90 